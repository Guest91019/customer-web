<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ระบบบริษัท - Login</title>
  <script type="module">
    import { register, login, saveRole, getRole, checkAuth } from "./js/app.js";

    const emailEl = document.getElementById("email");
    const passEl = document.getElementById("password");
    const roleSection = document.getElementById("roleSection");

    document.getElementById("registerBtn").addEventListener("click", () => {
      register(emailEl.value, passEl.value).then(userCred => {
        localStorage.setItem("uid", userCred.user.uid);
        roleSection.classList.remove("hidden");
      });
    });

    document.getElementById("saveRoleBtn").addEventListener("click", () => {
      const uid = localStorage.getItem("uid");
      const role = document.getElementById("roleSelect").value;
      saveRole(uid, role).then(() => {
        alert("บันทึกบทบาทสำเร็จ กรุณา login ใหม่");
      });
    });

    document.getElementById("loginBtn").addEventListener("click", () => {
      login(emailEl.value, passEl.value).then(userCred => {
        const uid = userCred.user.uid;
        getRole(uid, (role) => {
          if (role === "employee") location.href = "employee.html";
          if (role === "manager") location.href = "manager.html";
          if (role === "accountant") location.href = "accountant.html";
          if (role === "ceo") location.href = "ceo.html";
        });
      });
    });

    checkAuth(user => {
      if (user) console.log("Logged in:", user.email);
    });
  </script>
  <style>
    .hidden { display: none; }
  </style>
</head>
<body>
  <h2>ระบบบริษัท</h2>
  <input type="email" id="email" placeholder="อีเมล">
  <input type="password" id="password" placeholder="รหัสผ่าน">
  <button id="registerBtn">สมัคร</button>
  <button id="loginBtn">ล็อกอิน</button>

  <div id="roleSection" class="hidden" color="black">
    <h3>เลือกหน้าที่ของคุณ</h3>
    <select id="roleSelect">
      <option value="employee">กรอกข้อมูลลูกค้า</option>
      <option value="manager">หัวหน้า</option>
      <option value="accountant">บัญชี</option>
      <option value="ceo">CEO</option>
    </select>
    <button id="saveRoleBtn">บันทึกบทบาท</button>
  </div>
</body>
</html>
